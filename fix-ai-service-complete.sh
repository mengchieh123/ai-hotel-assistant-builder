#!/bin/bash

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ”§ ä¿®å¾© AI æœå‹™ - ç¬¦åˆ business-spec v2.1.0"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ç›®æ¨™ï¼šæ¸¬è©¦é€šéç‡ 17% â†’ 90%+"
echo ""

echo "1ï¸âƒ£ æª¢æŸ¥ç•¶å‰ç‹€æ…‹..."
if [ -f "services/mock-ai-service.js" ]; then
    echo "âœ… mock-ai-service.js å­˜åœ¨"
    echo "   ç•¶å‰ç‰ˆæœ¬å¯èƒ½æ˜¯èˆŠç‰ˆï¼ˆå°åŒ—æ™¶è¯ï¼ŒNT\$7,500ï¼‰"
else
    echo "âŒ mock-ai-service.js ä¸å­˜åœ¨"
    mkdir -p services
fi

echo ""
echo "2ï¸âƒ£ å‰µå»ºå®Œå…¨ç¬¦åˆ business-spec v2.1.0 çš„ AI æœå‹™..."
echo ""

cat > services/mock-ai-service.js << 'EOFAI'
// ============================================
// Mock AI Service v2.1.0
// å®Œå…¨ç¬¦åˆ business-spec.yaml v2.1.0-tw
// ============================================

class MockAIService {
  constructor() {
    this.sessionStore = new Map();
  }

  // ============================================
  // æ„åœ–è­˜åˆ¥ - 15ç¨®æ„åœ–é¡å‹
  // ============================================
  detectIntent(message) {
    const msg = message.toLowerCase().trim();
    
    // 1. å•å€™
    if (/^(ä½ å¥½|å—¨|å“ˆå›‰|hi|hello|æ—©å®‰|åˆå®‰|æ™šå®‰)/.test(msg)) {
      return 'greeting';
    }
    
    // 2. æˆ¿å‹æŸ¥è©¢
    if (/æˆ¿å‹|æˆ¿é–“ç¨®é¡|æœ‰ä»€éº¼æˆ¿|æœ‰å“ªäº›æˆ¿|æˆ¿é–“é¡å‹/.test(msg)) {
      return 'room_types';
    }
    
    // 3. åƒ¹æ ¼æŸ¥è©¢
    if (/åƒ¹æ ¼|å¤šå°‘éŒ¢|æˆ¿åƒ¹|åƒ¹ä½|è²»ç”¨|æ”¶è²»/.test(msg)) {
      return 'price';
    }
    
    // 4. è¨‚æˆ¿æ„åœ–
    if (/è¨‚æˆ¿|é è¨‚|é ç´„|æˆ‘è¦è¨‚|æƒ³è¨‚|book/.test(msg)) {
      return 'booking';
    }
    
    // 5. æœƒå“¡æŸ¥è©¢
    if (/æœƒå“¡|æœƒç±|ç©åˆ†|é»æ•¸|ç­‰ç´š|membership/.test(msg)) {
      return 'membership';
    }
    
    // 6. å–æ¶ˆæ”¿ç­–
    if (/å–æ¶ˆ|é€€æ¬¾|æ”¹æœŸ|ä¸èƒ½å»|cancel/.test(msg)) {
      return 'cancellation';
    }
    
    // 7. å…’ç«¥æ”¿ç­–
    if (/å°å­©|å…’ç«¥|å¬°å…’|å¹¼å…’|å­©å­|å°æœ‹å‹|kid|child/.test(msg)) {
      return 'children';
    }
    
    // 8. å…¥é€€æˆ¿æ™‚é–“
    if (/å…¥ä½|é€€æˆ¿|check.*in|check.*out|å¹¾é»/.test(msg)) {
      return 'checkin';
    }
    
    // 9. å„ªæƒ æ´»å‹•
    if (/å„ªæƒ |æŠ˜æ‰£|ä¿ƒéŠ·|ç‰¹åƒ¹|æ´»å‹•|deal|promo/.test(msg)) {
      return 'promotions';
    }
    
    // 10. ä»˜æ¬¾æ–¹å¼
    if (/ä»˜æ¬¾|æ”¯ä»˜|pay|LINE.*Pay|ä¿¡ç”¨å¡|è¶…å•†|ATM|åˆ†æœŸ/.test(msg)) {
      return 'payment';
    }
    
    // 11. è¨­æ–½æŸ¥è©¢
    if (/è¨­æ–½|è¨­å‚™|æœå‹™|amenity|facility|æ¸¸æ³³æ± |å¥èº«æˆ¿/.test(msg)) {
      return 'facilities';
    }
    
    // 12. æ—©é¤æŸ¥è©¢
    if (/æ—©é¤|breakfast/.test(msg)) {
      return 'breakfast';
    }
    
    // 13. åœè»ŠæŸ¥è©¢
    if (/åœè»Š|è»Šä½|parking/.test(msg)) {
      return 'parking';
    }
    
    // 14. äº¤é€šè³‡è¨Š
    if (/äº¤é€š|æ€éº¼å»|æ¥é€|transport/.test(msg)) {
      return 'transportation';
    }
    
    // 15. å°ç£ç‰¹è‰² - æ”¿åºœè£œåŠ©
    if (/åœ‹æ—…åˆ¸|æŒ¯èˆˆåˆ¸|äº”å€åˆ¸|æ”¿åºœè£œåŠ©/.test(msg)) {
      return 'taiwan_subsidy';
    }
    
    return 'unknown';
  }

  // ============================================
  // å›è¦†ç”Ÿæˆ - ç¬¦åˆ business-spec v2.1.0
  // ============================================
  generateResponse(intent, message) {
    const responses = {
      greeting: `ğŸ¨ æ­¡è¿å…‰è‡¨ï¼æˆ‘æ˜¯æ‚¨çš„è¨‚æˆ¿åŠ©ç†ã€‚

æˆ‘å¯ä»¥å”åŠ©æ‚¨ï¼š
â€¢ æŸ¥è©¢æˆ¿å‹èˆ‡åƒ¹æ ¼
â€¢ äº†è§£æœƒå“¡åˆ¶åº¦èˆ‡å„ªæƒ 
â€¢ é è¨‚æˆ¿é–“
â€¢ å–æ¶ˆæ”¿ç­–èªªæ˜
â€¢ å…’ç«¥æ”¿ç­–èˆ‡å®¶åº­å„ªæƒ 
â€¢ ä»˜æ¬¾æ–¹å¼ï¼ˆLINE Payã€è¶…å•†ç¹³è²»ç­‰ï¼‰

è«‹å•éœ€è¦ä»€éº¼å”åŠ©ï¼Ÿ`,

      room_types: `ğŸ¨ **æˆ¿å‹ä»‹ç´¹**

**è±ªè¯å®¢æˆ¿** - NT$ 3,800/æ™š
â€¢ 2ä½å¤§äºº + æœ€å¤š2ä½å…’ç«¥ï¼ˆ12æ­²ä»¥ä¸‹ï¼‰
â€¢ æˆ¿å…§æœ€å¤š3äººï¼ˆå«åŠ åºŠï¼‰
â€¢ èˆ’é©é›™äººåºŠ

**è¡Œæ”¿å®¢æˆ¿** - NT$ 4,800/æ™š
â€¢ 2ä½å¤§äºº + æœ€å¤š2ä½å…’ç«¥
â€¢ æˆ¿å…§æœ€å¤š3äººï¼ˆå«åŠ åºŠï¼‰
â€¢ å«æ—©é¤ã€è¿è³“é£²æ–™

**å®¶åº­å¥—æˆ¿** - NT$ 6,800/æ™š
â€¢ 2å¤§2å°æ¨™æº–é…ç½®
â€¢ æˆ¿å…§æœ€å¤š4äºº
â€¢ å«æ—©é¤ã€å…’ç«¥è¨­æ–½

**ç¸½çµ±å¥—æˆ¿** - NT$ 12,800/æ™š
â€¢ 4ä½å¤§äºº
â€¢ é ‚ç´šç¦®é‡ã€å«æ—©é¤

éœ€è¦äº†è§£æ›´å¤šæˆ–é è¨‚å—ï¼Ÿ`,

      price: `ğŸ’° **æˆ¿åƒ¹è³‡è¨Š**

**åŸºç¤æˆ¿åƒ¹**
â€¢ è±ªè¯å®¢æˆ¿ï¼šNT$ 3,800/æ™š
â€¢ è¡Œæ”¿å®¢æˆ¿ï¼šNT$ 4,800/æ™š
â€¢ å®¶åº­å¥—æˆ¿ï¼šNT$ 6,800/æ™š
â€¢ ç¸½çµ±å¥—æˆ¿ï¼šNT$ 12,800/æ™š

**é€£ä½å„ªæƒ **
â€¢ ä½2æ™šï¼š95æŠ˜
â€¢ ä½3-4æ™šï¼š90æŠ˜
â€¢ ä½5-6æ™šï¼š85æŠ˜
â€¢ ä½7æ™šä»¥ä¸Šï¼š80æŠ˜

**æ—©é³¥å„ªæƒ **
â€¢ æå‰30å¤©ï¼š85æŠ˜
â€¢ æå‰60å¤©ï¼š80æŠ˜
â€¢ æå‰90å¤©ï¼š75æŠ˜
â€¢ æå‰120å¤©ï¼š70æŠ˜

**æœƒå“¡æŠ˜æ‰£**
â€¢ éŠ€å¡ï¼š5%
â€¢ é‡‘å¡ï¼š8%
â€¢ ç™½é‡‘ï¼š12%

**å®˜ç¶²ç›´è¨‚æœ€å„ªæƒ ï¼Œæ¯”OTAå¹³å°ä¾¿å®œ5-10%ï¼**`,

      booking: `ğŸ“… **é–‹å§‹é è¨‚**

è«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š
1. å…¥ä½æ—¥æœŸï¼ˆä¾‹ï¼š12/25ï¼‰
2. é€€æˆ¿æ—¥æœŸï¼ˆä¾‹ï¼š12/27ï¼‰
3. æˆ¿å‹é¸æ“‡
4. å…¥ä½äººæ•¸ï¼ˆå¤§äºº+å°å­©ï¼‰

æˆ–ç›´æ¥èªªæ˜ï¼š
ã€Œæˆ‘è¦è¨‚è±ªè¯å®¢æˆ¿ï¼Œ12/25å…¥ä½2æ™šï¼Œ2å¤§1å°ã€

æˆ‘æœƒç‚ºæ‚¨è¨ˆç®—ç¸½åƒ¹ä¸¦å”åŠ©å®Œæˆé è¨‚ï¼`,

      membership: `ğŸ’ **æœƒå“¡åˆ¶åº¦**

**æ™®é€šæœƒå“¡**ï¼ˆè¨»å†Šå³å¯ï¼‰
â€¢ ç„¡æŠ˜æ‰£
â€¢ æ¯NT$100=1é»

**éŠ€å¡æœƒå“¡**
â€¢ æ¢ä»¶ï¼šå…¥ä½5æ™š æˆ– æ¶ˆè²»NT$10,000
â€¢ æŠ˜æ‰£ï¼š5%
â€¢ ç©åˆ†ï¼šæ¯NT$100=1.2é»
â€¢ æ¬Šç›Šï¼šæå‰1å°æ™‚å…¥ä½ã€å»¶é²1å°æ™‚é€€æˆ¿ã€è¿è³“æ°´æœ

**é‡‘å¡æœƒå“¡**
â€¢ æ¢ä»¶ï¼šå…¥ä½15æ™š æˆ– æ¶ˆè²»NT$30,000
â€¢ æŠ˜æ‰£ï¼š8%
â€¢ ç©åˆ†ï¼šæ¯NT$100=1.5é»
â€¢ æ¬Šç›Šï¼š12:00å…¥ä½ã€13:00é€€æˆ¿ã€å…è²»å‡ç­‰ã€è¿·ä½ å§å…è²»

**ç™½é‡‘æœƒå“¡**
â€¢ æ¢ä»¶ï¼šå…¥ä½30æ™š æˆ– æ¶ˆè²»NT$60,000
â€¢ æŠ˜æ‰£ï¼š12%
â€¢ ç©åˆ†ï¼šæ¯NT$100=2é»
â€¢ æ¬Šç›Šï¼šä¿è­‰å‡ç­‰ã€å…è²»æ©Ÿå ´æ¥é€ã€VIPç¦®é‡

**ç”Ÿæ—¥å„ªæƒ ï¼šç•¶æœˆå…¥ä½äº«85æŠ˜** ğŸ‚`,

      cancellation: `âŒ **å–æ¶ˆæ”¿ç­–**

**å…è²»å–æ¶ˆ**
â€¢ å…¥ä½å‰24å°æ™‚ï¼ˆå«ï¼‰å–æ¶ˆ
â€¢ å…¨é¡é€€æ¬¾
â€¢ è™•ç†æ™‚é–“ï¼š7-14å€‹å·¥ä½œæ—¥

**éƒ¨åˆ†é€€æ¬¾**
â€¢ å…¥ä½å‰12-24å°æ™‚å–æ¶ˆ
â€¢ é€€æ¬¾50%

**ä¸å¯é€€æ¬¾**
â€¢ å…¥ä½å‰12å°æ™‚å…§
â€¢ ä¸å¯å–æ¶ˆã€ä¸å¯é€€æ¬¾

**ç‰¹æ®Šæ”¿ç­–**
â€¢ é€£å‡æœŸé–“ï¼šå…¥ä½å‰72å°æ™‚ä¸å¯å–æ¶ˆ
â€¢ æ˜¥ç¯€æœŸé–“ï¼šå…¥ä½å‰7å¤©ä¸å¯å–æ¶ˆ
â€¢ å¤©ç½æ¢æ¬¾ï¼šé¢±é¢¨/åœ°éœ‡å¯å½ˆæ€§è™•ç†

**å½ˆæ€§å–æ¶ˆæ–¹æ¡ˆ**ï¼ˆåŠ åƒ¹10%ï¼‰
â€¢ å…¥ä½å‰3å°æ™‚ä»å¯å…è²»å–æ¶ˆ`,

      children: `ğŸ‘¶ **å…’ç«¥æ”¿ç­–**

**å¹´é½¡å®šç¾©**
â€¢ å¬°å…’ï¼š0-3æ­²
â€¢ å¹¼å…’ï¼š4-6æ­²
â€¢ å…’ç«¥ï¼š7-12æ­²
â€¢ é’å°‘å¹´ï¼š13-17æ­²

**è²»ç”¨æ¨™æº–**
â€¢ 0-3æ­²ï¼šå…è²»ï¼ˆæä¾›å¬°å…’åºŠï¼‰
â€¢ 4-6æ­²ï¼šå…è²»ï¼ˆèˆ‡å¤§äººåŒåºŠï¼‰
  åŠ åºŠï¼šNT$ 300/æ™š
â€¢ 7-12æ­²ï¼šåŠ åºŠ NT$ 500/æ™šï¼ˆå«æ—©é¤ï¼‰
â€¢ 13æ­²ä»¥ä¸Šï¼šè¦–åŒæˆäºº NT$ 800/æ™š

**å…’ç«¥è¨­æ–½**
â€¢ å…’ç«¥éŠæˆ²å®¤ï¼ˆå…è²»ï¼‰
â€¢ å…’ç«¥æˆ²æ°´æ± 
â€¢ å…’ç«¥é¤å…·èˆ‡åº§æ¤…
â€¢ å¬°å…’åºŠã€æ¾¡ç›†ã€æ¶ˆæ¯’é‹ï¼ˆå…è²»å€Ÿç”¨ï¼‰

**æš‘å‡å®¶åº­å°ˆæ¡ˆ**
â€¢ 2å¤§2å°å…¥ä½å®¶åº­å¥—æˆ¿
â€¢ ç¬¬2ä½å…’ç«¥å…è²»ï¼`,

      checkin: `ğŸ¨ **å…¥é€€æˆ¿æ™‚é–“**

**æ¨™æº–æ™‚é–“**
â€¢ å…¥ä½ï¼š15:00
â€¢ é€€æˆ¿ï¼š11:00

**æœƒå“¡ç¦®é‡**
â€¢ éŠ€å¡ï¼šæå‰1å°æ™‚å…¥ä½ã€å»¶é²1å°æ™‚é€€æˆ¿
â€¢ é‡‘å¡ï¼š12:00å…¥ä½ã€13:00é€€æˆ¿
â€¢ ç™½é‡‘ï¼šä¿è­‰12:00å…¥ä½ã€ä¿è­‰14:00é€€æˆ¿

**ææ—©å…¥ä½**
â€¢ 14:00å¾Œå…è²»ï¼ˆè¦–æˆ¿æ³ï¼‰
â€¢ 12:00-15:00ï¼šåŠå¤©æˆ¿è²»

**å»¶é²é€€æˆ¿**
â€¢ å»¶é²1å°æ™‚å…è²»ï¼ˆè¦–æˆ¿æ³ï¼‰
â€¢ 12:00-18:00ï¼šåŠå¤©æˆ¿è²»
â€¢ 18:00å¾Œï¼šå…¨å¤©æˆ¿è²»

**è­‰ä»¶è¦æ±‚**
â€¢ æœ¬åœ‹äººï¼šèº«åˆ†è­‰ã€é§•ç…§æˆ–å¥ä¿å¡
â€¢ å¤–åœ‹äººï¼šè­·ç…§
â€¢ æœªæ»¿18æ­²ï¼šéœ€ç›£è­·äººé™ªåŒ`,

      promotions: `ğŸ‰ **å„ªæƒ æ´»å‹•**

**é€£ä½å„ªæƒ **
â€¢ 2æ™šï¼š95æŠ˜
â€¢ 3-4æ™šï¼š90æŠ˜
â€¢ 5-6æ™šï¼š85æŠ˜
â€¢ 7æ™šä»¥ä¸Šï¼š80æŠ˜

**æ—©é³¥å„ªæƒ **
â€¢ 30å¤©å‰ï¼š85æŠ˜
â€¢ 60å¤©å‰ï¼š80æŠ˜
â€¢ 90å¤©å‰ï¼š75æŠ˜

**å®˜ç¶²ç›´è¨‚å„ªæƒ **
â€¢ æ¯”OTAä¾¿å®œ5-10%
â€¢ é¡å¤–è´ˆé€ï¼šæ—©é¤å‡ç´šã€è¿è³“é£²æ–™

**ç”Ÿæ—¥å„ªæƒ ** ğŸ‚
â€¢ ç•¶æœˆå…¥ä½ï¼š85æŠ˜
â€¢ ç”Ÿæ—¥è›‹ç³•è´ˆé€

**æœƒå“¡æŠ˜æ‰£**
â€¢ éŠ€å¡ï¼š5%
â€¢ é‡‘å¡ï¼š8%
â€¢ ç™½é‡‘ï¼š12%

**åœ‹æ—…åˆ¸/æŒ¯èˆˆåˆ¸**
â€¢ æœ€é«˜æŠ˜æŠµNT$1,000/æˆ¿/æ™š

**æ¨è–¦çå‹µ**
â€¢ æ¨è–¦æœ‹å‹ç²å¾—500ç©åˆ†`,

      payment: `ğŸ’³ **ä»˜æ¬¾æ–¹å¼**

**ç·šä¸Šæ”¯ä»˜**
â€¢ ä¿¡ç”¨å¡ï¼ˆVisa/Master/JCB/AEï¼‰
â€¢ LINE Payï¼ˆäº«3%å›é¥‹ï¼‰âœ¨
â€¢ è¡—å£æ”¯ä»˜ï¼ˆäº«2%å›é¥‹ï¼‰
â€¢ Apple Pay / Google Pay
â€¢ å°ç£Pay

**è¶…å•†ä»£ç¢¼ç¹³è²»** ğŸª
â€¢ 7-11 ibon
â€¢ å…¨å®¶ FamiPort
â€¢ èŠçˆ¾å¯Œ Life-ET
â€¢ OK ä¾¿åˆ©å•†åº—
â€¢ 3å¤©å…§å®Œæˆç¹³è²»

**ATM è½‰å¸³**
â€¢ è™›æ“¬å¸³è™Ÿç¹³è²»
â€¢ 3å¤©å…§å®Œæˆè½‰å¸³

**ç¾å ´ä»˜æ¬¾**
â€¢ ä¿¡ç”¨å¡
â€¢ ç¾é‡‘ï¼ˆæ–°å°å¹£ï¼‰
â€¢ è¡Œå‹•æ”¯ä»˜

**åˆ†æœŸä»˜æ¬¾**
â€¢ æ»¿NT$3,000ï¼š3æœŸå…æ¯
â€¢ æ»¿NT$6,000ï¼š6æœŸå…æ¯
â€¢ æ»¿NT$12,000ï¼š12æœŸå…æ¯

**ç™¼ç¥¨é–‹ç«‹**
â€¢ é›»å­ç™¼ç¥¨ï¼ˆå¯å­˜è¼‰å…·ï¼‰
â€¢ ä¸‰è¯å¼ç™¼ç¥¨ï¼ˆæä¾›çµ±ç·¨ï¼‰`,

      taiwan_subsidy: `ï¿½ï¿½ğŸ‡¼ **æ”¿åºœè£œåŠ©ä½¿ç”¨**

**åœ‹æ—…åˆ¸**
â€¢ æœ€é«˜æŠ˜æŠµï¼šNT$1,000/æˆ¿/æ™š
â€¢ ä½¿ç”¨é™åˆ¶ï¼šåƒ…é™å®˜ç¶²è¨‚æˆ¿
â€¢ æ ¸éŠ·æ–¹å¼ï¼šå…¥ä½æ™‚å‡ºç¤ºåˆ¸è™Ÿ

**æŒ¯èˆˆåˆ¸ / äº”å€åˆ¸**
â€¢ å¯ç·šä¸Šä½¿ç”¨æˆ–ç¾å ´æ ¸éŠ·
â€¢ ä¸å¯èˆ‡å…¶ä»–å„ªæƒ ä½µç”¨

**å®‰å¿ƒæ—…éŠè£œåŠ©**
â€¢ æ¯æˆ¿æ¯æ™šæœ€é«˜æŠ˜æŠµNT$1,000
â€¢ ç¬¦åˆæ”¿åºœè¦å®šä¹‹æ—…å®¢
â€¢ è¨‚æˆ¿æ™‚é¸æ“‡è£œåŠ©æ–¹æ¡ˆ

ä½¿ç”¨æ–¹å¼ï¼šè¨‚æˆ¿æ™‚å‘ŠçŸ¥ä½¿ç”¨è£œåŠ©åˆ¸ï¼Œæˆ‘å€‘æœƒå”åŠ©æ‚¨ç”³è«‹ï¼`,

      facilities: `ğŸŠ **é£¯åº—è¨­æ–½**

**ä¼‘é–’è¨­æ–½**
â€¢ å®¤å…§æ¸¸æ³³æ± 
â€¢ å¥èº«æˆ¿ï¼ˆ24å°æ™‚ï¼‰
â€¢ SPA æ°´ç™‚ä¸­å¿ƒ
â€¢ å…’ç«¥éŠæˆ²å®¤

**é¤é£²æœå‹™**
â€¢ è‡ªåŠ©å¼æ—©é¤ï¼ˆ06:30-10:00ï¼‰
â€¢ å…¨æ—¥é¤å»³
â€¢ é…’å§ / å’–å•¡å»³

**å•†å‹™æœå‹™**
â€¢ å•†å‹™ä¸­å¿ƒ
â€¢ æœƒè­°å®¤
â€¢ å…è²» WiFi

**å…¶ä»–æœå‹™**
â€¢ 24å°æ™‚æ«ƒæª¯
â€¢ ç¦®è³“æœå‹™
â€¢ æ´—è¡£æœå‹™
â€¢ åœè»Šå ´ï¼ˆå…è²»ï¼‰`,

      breakfast: `ğŸ³ **æ—©é¤è³‡è¨Š**

**è²»ç”¨**
â€¢ æˆäººï¼šNT$ 450/äºº/å¤©
â€¢ å…’ç«¥ï¼ˆ7-12æ­²ï¼‰ï¼šNT$ 250/äºº/å¤©
â€¢ 6æ­²ä»¥ä¸‹ï¼šå…è²»

**åŒ…å«æ—©é¤æˆ¿å‹**
â€¢ è¡Œæ”¿å®¢æˆ¿ âœ“
â€¢ å®¶åº­å¥—æˆ¿ âœ“
â€¢ ç¸½çµ±å¥—æˆ¿ âœ“

**ä¾›æ‡‰æ™‚é–“**
â€¢ 06:30 - 10:00

**æ—©é¤å…§å®¹**
â€¢ ä¸­å¼ç†±é£Ÿ
â€¢ è¥¿å¼éºµåŒ…
â€¢ æ–°é®®æ°´æœ
â€¢ å’–å•¡ã€æœæ±`,

      parking: `ğŸš— **åœè»Šè³‡è¨Š**

â€¢ å…è²»åœè»Šå ´
â€¢ 24å°æ™‚é–‹æ”¾
â€¢ å®¤å…§åœè»Šä½
â€¢ å…ˆåˆ°å…ˆåœ
â€¢ é›»å‹•è»Šå……é›»è¨­æ–½

å…¥ä½æ™‚å‘ŠçŸ¥è»Šç‰Œè™Ÿç¢¼å³å¯ï¼`,

      transportation: `ğŸšŒ **äº¤é€šè³‡è¨Š**

**æ©Ÿå ´æ¥é€**
â€¢ ç™½é‡‘æœƒå“¡ï¼šå…è²»1è¶Ÿï¼ˆé™é›™åŒ—ï¼‰
â€¢ å…¶ä»–æœƒå“¡ï¼šå„ªæƒ åƒ¹NT$800

**å¤§çœ¾é‹è¼¸**
â€¢ æ·é‹ï¼šXXç«™æ­¥è¡Œ5åˆ†é˜
â€¢ å…¬è»Šï¼šå¤šæ¢è·¯ç·šå¯é”

**è‡ªé§•**
â€¢ å…è²»åœè»Šå ´
â€¢ å°èˆªåœ°å€ï¼šXXX

**é«˜éµ/ç«è»Šç«™**
â€¢ è¨ˆç¨‹è»Šç´„15åˆ†é˜
â€¢ å¯é ç´„æ¥é€æœå‹™`,

      unknown: `ğŸ¤– æŠ±æ­‰ï¼Œæˆ‘ä¸å¤ªç†è§£æ‚¨çš„å•é¡Œã€‚

æˆ‘å¯ä»¥å”åŠ©æ‚¨ï¼š
â€¢ æŸ¥è©¢ã€Œæˆ¿å‹ã€å’Œã€Œåƒ¹æ ¼ã€
â€¢ ã€Œè¨‚æˆ¿ã€æœå‹™
â€¢ ã€Œæœƒå“¡ã€åˆ¶åº¦èªªæ˜
â€¢ ã€Œå–æ¶ˆã€æ”¿ç­–æŸ¥è©¢
â€¢ ã€Œå…’ç«¥ã€æ”¿ç­–èˆ‡å®¶åº­å„ªæƒ 
â€¢ ã€Œå„ªæƒ ã€æ´»å‹•è³‡è¨Š
â€¢ ã€Œä»˜æ¬¾ã€æ–¹å¼
â€¢ ã€Œåœ‹æ—…åˆ¸ã€ä½¿ç”¨

è«‹å•éœ€è¦ä»€éº¼å”åŠ©ï¼Ÿ`
    };

    return {
      message: responses[intent] || responses.unknown,
      intent: intent,
      timestamp: new Date().toISOString()
    };
  }

  // ============================================
  // ä¸»è¦è™•ç†å‡½æ•¸
  // ============================================
  async processMessage(message, sessionId = 'default') {
    try {
      const intent = this.detectIntent(message);
      const response = this.generateResponse(intent, message);
      
      this.sessionStore.set(sessionId, {
        lastIntent: intent,
        lastMessage: message,
        timestamp: new Date().toISOString()
      });
      
      return response;
    } catch (error) {
      console.error('AI Service Error:', error);
      return {
        message: 'âŒ æŠ±æ­‰ï¼Œç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
        intent: 'error',
        timestamp: new Date().toISOString()
      };
    }
  }
}

module.exports = new MockAIService();
EOFAI

echo "âœ… mock-ai-service.js å·²å‰µå»ºï¼ˆç¬¦åˆ business-spec v2.1.0ï¼‰"
echo ""

echo "3ï¸âƒ£ ç¢ºä¿ routes/ai-routes.js æ­£ç¢º..."
cat > routes/ai-routes.js << 'EOFROUTES'
const express = require('express');
const router = express.Router();
const aiService = require('../services/mock-ai-service');

router.post('/chat', async (req, res) => {
  try {
    const { message, sessionId } = req.body;
    
    if (!message) {
      return res.status(400).json({ 
        success: false, 
        message: 'ç¼ºå°‘è¨Šæ¯å…§å®¹' 
      });
    }
    
    const response = await aiService.processMessage(message, sessionId || 'default');
    
    res.json({
      success: true,
      message: response.message,
      intent: response.intent,
      timestamp: response.timestamp
    });
    
  } catch (error) {
    console.error('AI Chat Error:', error);
    res.status(500).json({ 
      success: false, 
      message: 'è™•ç†éŒ¯èª¤: ' + error.message 
    });
  }
});

module.exports = router;
EOFROUTES

echo "âœ… ai-routes.js å·²æ›´æ–°"
echo ""

echo "4ï¸âƒ£ æäº¤ä¸¦æ¨é€..."
git add services/mock-ai-service.js routes/ai-routes.js

git commit -m "fix: upgrade AI service to business-spec v2.1.0 compliance

âœ… Price correction: NT\$3,800 (not NT\$7,500)
âœ… 15 intent types with comprehensive responses
âœ… Taiwan-specific features:
   - LINE Pay integration
   - Government subsidies (åœ‹æ—…åˆ¸, æŒ¯èˆˆåˆ¸)
   - Convenience store payment
   - Family-friendly policies
   - Natural disaster handling
âœ… Membership system (éŠ€å¡/é‡‘å¡/ç™½é‡‘)
âœ… Children policy (0-6æ­²å…è²»)
âœ… Complete facilities & services info

Target: Test pass rate 17% â†’ 90%+"

git push origin main

if [ $? -eq 0 ]; then
    echo ""
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "âœ… AI æœå‹™ä¿®å¾©å®Œæˆä¸¦å·²æ¨é€"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "â³ ç­‰å¾… Railway éƒ¨ç½²ï¼ˆ2-3 åˆ†é˜ï¼‰..."
    echo ""
    echo "éƒ¨ç½²å®Œæˆå¾ŒåŸ·è¡Œæ¸¬è©¦ï¼š"
    echo "  bash test-booking-flow-complete.sh"
    echo ""
    echo "é æœŸæ”¹é€²ï¼š"
    echo "  â€¢ åƒ¹æ ¼æ­£ç¢ºï¼šNT\$ 3,800"
    echo "  â€¢ é€šéç‡ï¼š17% â†’ 90%+"
    echo "  â€¢ æ‰€æœ‰å°ç£ç‰¹è‰²åŠŸèƒ½æ­£å¸¸"
    echo ""
else
    echo ""
    echo "âŒ æ¨é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯"
    echo ""
fi

